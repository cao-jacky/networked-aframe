<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Image based tracking AR.js demo</title>
    <!-- import aframe and then ar.js with image tracking / location based features -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.4.0/socket.io.slim.js"></script>
    <script src="/easyrtc/easyrtc.js"></script>
    <script src="/dist/networked-aframe.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
            integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
            crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/aframe-randomizer-components@^3.0.1/dist/aframe-randomizer-components.min.js"></script>
    <script src="https://unpkg.com/aframe-button-controls@^1.1.0/aframe-button-controls.js"></script>
    <script src="/js/spawn-in-circle.component.js"></script>
    <!-- <script src="/js/aframe-ar.js"></script> -->
    <script src='https://raw.githack.com/AR-js-org/AR.js/ES6/aframe/build/aframe-ar-nft.js'></script>
    <script>THREEx.ArToolkitContext.baseURL = 'https://rawgit.com/jeromeetienne/ar.js/master/three.js/'</script>
    <script src="https://kit.fontawesome.com/6187a9970c.js" crossorigin="anonymous"></script>
    <!-- style for the loader -->
    <link rel="stylesheet" href="fabstyle.css" type="text/css" media="all">

    <script>
        // see issue https://github.com/networked-aframe/networked-aframe/issues/267
        NAF.schemas.getComponentsOriginal = NAF.schemas.getComponents;
        NAF.schemas.getComponents = (template) => {
          if (!NAF.schemas.hasTemplate("#avatar-template")) {
            NAF.schemas.add({
              template: '#avatar-template',
               components: [
                'position',
                'rotation',
                {
                  selector: '.head',
                  component: 'material',
                  property: 'color'
                }
              ]
            });
          }
          const components = NAF.schemas.getComponentsOriginal(template);
          return components;
        }
      </script>
    <style>
    </style>
</head>

<body>
    <div class="arjs-loader">
        <div>Loading, please wait...</div>
      </div>
    <a-scene networked-scene="room: basic-video; debug: true; adapter: easyrtc; audio: true; video: true; onConnect: onARConnect;"
             arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
        <a-assets>
            <img id="grid" src="https://img.gs/bbdkhfbzkk/stretch/https://i.imgur.com/25P1geh.png" crossorigin="anonymous">
            <a-asset-item id="arrow3d" src="arrow.glb"></a-asset-item>
            <img id="arrowImg"
                 src="arrow.png" />
            <template id="avatar-template">
                <a-entity class="avatar">
                    <a-plane color="#FFF" width="0.45" height="0.8" position="0.2 0.5 -1" rotation="0 0 0" material="side: front;opacity: 0.5; transparent: true" networked-video-source networked-audio-source></a-plane>
                </a-entity>
            </template>
            <template id="mavatar-template">
                <a-entity class="avatar">
                    <a-plane color="#FFF" width="0.45" height="0.8" position="0 0 -1" rotation="0 0 0" material="side: front;opacity: 0.5; transparent: true" networked-video-source networked-audio-source></a-plane>
                </a-entity>
            </template>
            <template id="marker-template">
                <a-entity rotation="270 0 0">
                    <!-- text="xOffset:7; width:13;" position="0 0 -1"> -->
                        <a-box geometry="primitive: box" material="color: #303971; opacity: 0.5" scale="2 0.7 0.05" ></a-box>
                        <!-- <a-text align="center" class="aentitiyblock" width="5"></a-text> -->
                        <a-text align="center" class="aentitiyblock" width="9" value="" color="white" position="0 0 0" z-offset="0.11" wrap-count="125"></a-text>

                        <!-- <a-image class="imgMarker" src="#arrowImg" position="-0.5 0 0" width="1" height="1"></a-image> -->
                       
                </a-entity>
                <!-- static camera that moves according to the device movemenents -->
            </template>
            <!-- <template id="pointer-template">
                <a-entity gltf-model="#arrow3d" material="metalness: 0.8; color:#43A367;" scale="0.1 0.1 0.1">
                    <a-torus id="pointergeo" scale="0.01 0.01 0.01" color="#43A367" radius="0.5" radius-tubular="0.1"></a-torus>
                </a-entity>
            </template> -->

        </a-assets>
        <a-entity button-controls></a-entity>
        <!-- <a-entity id="pointerCtrl" position="0 0 0" scale="0.1 0.1 0.1" networked="template:#pointer-template;" clickpointd> -->
        </a-entity>

        <a-nft
        type='nft' url='./trex/trex-image/trex'
        smooth='true' smoothCount='10' smoothTolerance='0.01' smoothThreshold='5'>
        <!-- <a-text value="Parking" color="red" position="0 0 0" scale="350 350 350" side="double"></a-text> -->
        <a-entity rotation="270 0 0" scale="150 150 0" position="300 -300 0">
            <!-- text="xOffset:7; width:13;" position="0 0 -1"> -->
                <a-box geometry="primitive: box" material="color: #303971; opacity: 0.5" scale="4 1.5 0.05"></a-box>
                <a-text value="aaaa" align="center" width="100" value="" color="white" z-offset="300" wrap-count="125" ></a-text>               
                <!-- <a-text value="Parking" color="red" position="0 0 0" scale="350 350 350" side="double" rotation="270 0 0"></a-text> -->

            </a-entity>
        </a-nft>

        <a-entity id="player" camera wasd-controls
                  networked="template:#avatar-template;attachTemplateToLocal:false;"
                  position="0 0 0">
            <a-entity arrow position="0 1.6 -3"></a-entity>
            <a-entity arrow="length: 2" scale="1 1 1" position="0 1.7 -3"></a-entity>
            <a-entity arrow="color: #fff" position="0 1.8 -3"></a-entity>
            <a-entity arrow="headLength: 1" position="0 1.9 -3"></a-entity>
            <a-entity arrow="length: 3; headWidth: .5" position="0 2 -3"></a-entity>
            <a-entity arrow="direction: 1 1 0" position="0 2.1 -3"></a-entity>
            <a-entity arrow="direction: 1 -1 0; length: 1" position="0 1.5 -3"></a-entity>



            <a-entity id="markerPlacer">
                <a-marker type="barcode" size="0.06" value="0" id="ftextA" registerevents>
                    <a-entity networked="template:#marker-template">
                    </a-entity>
                </a-marker>
                <a-marker type="barcode" size="0.06" value="1" id="stextA" registerevents>
                    <a-entity networked="template:#marker-template">
                    </a-entity>
                </a-marker>
                <a-marker type="barcode" size="0.06" value="10" id="ttextA" registerevents>
                    <a-entity networked="template:#marker-template">
                    </a-entity>
                </a-marker>
            </a-entity>
            <a-sphere class="head"
                      visible="false"
                      random-color></a-sphere>
        </a-entity>

        <a-entity position="0 -1.6 -100"
                  geometry="primitive: plane; width: 10000; height: 10000;" rotation="-90 0 0"
                  material="src: #grid; repeat: 10000 10000; transparent: true; metalness:0.6; roughness: 0.4; sphericalEnvMap: #sky;"></a-entity>

    </a-scene>

    <button id="mic-btn" type="button" class="camera-btn">Mute Mic</button>
    <button id="camera-btn" type="button" class="camera-btn">Hide Cam</button>
    
    <div class="support_tags vr-overlay-content ">
        <form id="editTextForm">
            <!-- <input type="button" value="Stop Image From Client" id="myStopInterval" class="btn btn-danger">
    <input type="button" value="Start Image From Client" class="btn btn-success" id="startInterval">-->
            <div class="tag_box_header">Configure Marker Tags</div>
            <table id="tag_table">
                <tr>
                    <td><label for="ftext">Tag 1:</label></td>
                    <td><input type="text" onchange="UpdateText(this.id)" id="ftext" name="ftext" class="updatetextfield" value="Open the cover to start"></td>
                </tr>
                <tr>
                    <td><label for="stext">Tag 2:</label></td>
                    <td><input type="text" onchange="UpdateText(this.id)" id="stext" name="stext" class="updatetextfield" value="Put below this position"></td>
                </tr>
                <tr>
                    <td><label for="ttext">Tag 3:</label></td>
                    <td><input type="text" onchange="UpdateText(this.id)" id="ttext" name="ttext" class="updatetextfield" value="Close the cover"></td>
                </tr>
            </table>
        </form>
        <div id="new_tag_button">
            <button id="newTagBtn" class="btn btn-info"><i class="fa-solid fa-square-plus" id="new_tag_icon"></i></br>New Tag</button>
        </div>
        <div id="connectedBtnCtrl"></div>
        <!-- Press X, C, Z to move pointer x, y, z. -->
        <canvas id="webcam2d"  ></canvas>
    </div> 

    <script>
        // Camera status
        let cameraEnabled = true;
        var countNewUser = 1;
        var markerScale = 0.2;
        // Camera button ele
        const micBtnEle = document.getElementById('mic-btn');
        const cameraBtnEle = document.getElementById('camera-btn');
        let connectedBtnCtrl = document.getElementById('connectedBtnCtrl');
        var rotX = 0, rotY = 0, rotZ = 0, currentScale = 0.1;
        NAF.schemas.add({
            template: '#avatar-template',
            components: [
                'position',
                'rotation',
                'scale'
            ]
        });
        
        // NAF.schemas.add({
        //     template: '#pointer-template',
        //     components: [
        //         'position',
        //         'rotation',
        //         'scale'
        //     ]
        // });
        NAF.options.updateRate = 10;
        AFRAME.registerComponent('clickpointd', {
            schema: { speed: { default: 1 } },
            init: function () {
                this.ifMouseDown = false;
                this.x_cord = 0;
                this.y_cord = 0;
                //var sceneEl = document.querySelector('a-scene');
                //sceneEl.addEventListener('mousedown', this.OnDocumentMouseDown.bind(this));
                //sceneEl.addEventListener('mouseup', this.OnDocumentMouseUp.bind(this));
                //sceneEl.addEventListener('mousemove', this.OnDocumentMouseMove.bind(this));
                // document.addEventListener('mousedown', this.OnDocumentMouseDown.bind(this));
                // document.addEventListener('mouseup', this.OnDocumentMouseUp.bind(this));
                // document.addEventListener('mousemove', this.OnDocumentMouseMove.bind(this));
                this.x_cord = 0;
                this.y_cord = 0;
            },
            OnDocumentMouseDown: function (event) { 
                var scanvas = document.querySelector('a-scene').components.screenshot.getCanvas('equirectangular');
                markerScale = 0.1;
                this.ifMouseDown = true;
                this.widthHalf = scanvas.width / 2;
                this.heightHalf = scanvas.height / 2;

                var mouse = { x: 0, y: 0 };
                //  var camera = document.querySelector('#player');
                var cameraP = AFRAME.scenes[0].camera;
                var rect = document.querySelector('body').getBoundingClientRect();
                mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
                mouse.y = - ((event.clientY - rect.top) / rect.height) * 2 + 1;
                var vector = new THREE.Vector3(mouse.x, mouse.y, -1).unproject(cameraP);

                var positionStr = String(vector.x) + " " + String(vector.y) + " " + String(vector.z-1);
                this.el.setAttribute('position', positionStr);
                this.el.setAttribute('scale', { x: markerScale, y: markerScale, z: markerScale });
                console.log("OnDocumentMouseDown " + positionStr);
                this.x_cord = event.clientX;
                this.y_cord = event.clientY;
            },
            OnDocumentMouseMove: function (event) { 
                if (this.ifMouseDown) {
                    var temp_x = event.clientX - this.x_cord;
                    var temp_y = event.clientY - this.y_cord;
                    if (Math.abs(temp_y) < Math.abs(temp_x)) {
                        this.el.object3D.rotateY(temp_x * this.data.speed / 500);
                    }
                    else {
                        this.el.object3D.rotateZ(temp_y * this.data.speed / 200);
                    }
                    this.x_cord = event.clientX;
                    this.y_cord = event.clientY;
                }
            },
            OnDocumentMouseUp: function (event) { 
                this.ifMouseDown = false;
            }, tick: function () {
                // only move it when certain state is meet
                //if (markerScale > 0.001) {
                //    markerScale = markerScale - 0.01;
                //    this.el.setAttribute('scale', { x: markerScale, y: markerScale, z: markerScale });
                //    console.log("In tick ");
                //}
            }
        });
        function showInput(evt) {
            var elems =  document.querySelectorAll('.hideInput');
            var index = 0, length = elems.length;
            for (; index < length; index++) {
                elems[index].style.display = "none";
            }
            evt.querySelector('input').style.display = 'inline';
        } 
        function onARConnect() {
            console.log("onARConnect", new Date());
            // Handle camera button click (Off and On)
            cameraBtnEle.addEventListener('click', function () {
                NAF.connection.adapter.enableCamera(!cameraEnabled);
                cameraEnabled = !cameraEnabled;
                cameraBtnEle.textContent = cameraEnabled ? 'Hide Camera' : 'Show Camera';
            });

            document.body.addEventListener('entityCreated', function (evt) {
                var nuid = evt.detail.el.id;
                var netwstr = evt.detail.el.getAttribute("networked").template;

                console.error('entityCreated event', evt.detail.el, netwstr, nuid);
                if (nuid != "pointerCtrl" && nuid != "pointergeo" && !nuid.includes('text') && !netwstr.includes("#marker-template")) {
                    var newNuidDiv = document.createElement("div");
                    newNuidDiv.id = nuid + "div";
                    var posi = new THREE.Vector3(0, 0, 0);
                    var rota = new THREE.Vector3(0, 0, 0);
                    evt.detail.el.setAttribute('position', posi);
                    evt.detail.el.setAttribute('rotation', rota);
                    var btn = document.createElement("button");
                    btn.innerHTML = "Hide User " + countNewUser + " Cam";
                    btn.name = nuid;
                    btn.className = "btn btn-success";
                    btn.addEventListener("click", function (e) {
                        var bt = document.querySelector("#" + e.target.name);
                        var vis = bt.getAttribute('visible');
                        bt.setAttribute('visible', !vis);
                        if (vis) {
                            e.target.innerHTML = e.target.innerHTML.replace("Hide", "Show");
                        }
                        else {
                            e.target.innerHTML = e.target.innerHTML.replace("Show", "Hide");
                        }
                    });

                    newNuidDiv.appendChild(btn);
                    var btnStick = document.createElement("button");
                    btnStick.innerHTML = "Stick User " + countNewUser;
                    btnStick.className = "btn btn-primary";
                    btnStick.name = nuid + "s";
                    btnStick.addEventListener("click", function (e) {
                        var player = document.querySelector("#player");
                        var tgname = e.target.name.substring(0, e.target.name.length - 1);
                        console.log("tgname " + tgname)
                        var bt = document.querySelector("#" + tgname);
                        var pos = bt.getAttribute('position');
                        var rot = bt.getAttribute('rotation');
                        player.setAttribute('position', pos);
                        player.setAttribute('rotation', rot);
                    });
                    newNuidDiv.appendChild(btnStick);
                    countNewUser++;
                    connectedBtnCtrl.appendChild(newNuidDiv);
                }
            });
            document.body.addEventListener('clientDisconnected', function (evt) {
                console.error('clientDisconnected event. clientId =', evt.detail.clientId);
                var nuid = evt.detail.el.id;
                var newNuidDiv = document.querySelector("#" + nuid + "div");
                newNuidDiv.innerHTML = "";
            }); 
            document.body.addEventListener('entityRemoved', function (evt) {
                console.error('entityRemoved event. Entity networkId =', evt.detail.networkId);
            });
        }
        // document.addEventListener('keydown', (event) => {
        //     var name = event.key;
        //     var code = event.code;
        //     var pointerObj = document.querySelector("#pointerCtrl");
        //     var position = pointerObj.getAttribute('position');
        //     rotX = position.x;
        //     rotY = position.y;
        //     rotZ = position.z;
        //     // Alert the key name and key code on keydown
        //     // alert(`Key pressed ${name} \r\n Key code value: ${code}`);
        //     switch (name) {
        //         case 'x':
        //             rotX = (rotX + 0.005) ;
        //             pointerObj.setAttribute('position', { x: rotX, y: rotY, z: rotZ });
        //             break;
        //         case 'X':
        //             rotX = (rotX - 0.005) ;
        //             pointerObj.setAttribute('position', { x: rotX, y: rotY, z: rotZ });
        //             break;
        //         case 'c':
        //             rotY = (rotY + 0.005) ;
        //             pointerObj.setAttribute('position', { x: rotX, y: rotY, z: rotZ });
        //             // expected output: "Mangoes and papayas are $2.79 a pound."
        //             break;
        //         case 'C':
        //             rotY = (rotY - 0.005) ;
        //             pointerObj.setAttribute('position', { x: rotX, y: rotY, z: rotZ });
        //             // expected output: "Mangoes and papayas are $2.79 a pound."
        //             break;
        //         case 'z':
        //             rotZ = (rotZ + 0.005) ;
        //             pointerObj.setAttribute('position', { x: rotX, y: rotY, z: rotZ });
        //             break;
        //         case 'Z':
        //             rotZ = (rotZ - 0.005) ;
        //             pointerObj.setAttribute('position', { x: rotX, y: rotY, z: rotZ });
        //             break;
        //         case 'v':
        //             currentScale = currentScale - 0.005;
        //             pointerObj.setAttribute('scale', { x: currentScale, y: currentScale, z: currentScale });
        //             break;
        //         case 'V':
        //             currentScale = currentScale + 0.005;
        //             pointerObj.setAttribute('scale', { x: currentScale, y: currentScale, z: currentScale });
        //             break;  
        //     }
        // }, false);
        
        function UpdateVid(targetID) {
            console.log("UpdateVid", targetID);
            var strupdate = document.getElementById(targetID).value;
 
            targetID = targetID.substring(0, targetID.length - 1);
            console.log(strupdate, targetID);
            var fbtn = "#" + targetID + "A .MarkerVideo";
            document.querySelector(fbtn).setAttribute('src', strupdate);
            var markerId = targetID + "A";
            var element = document.getElementById(markerId);
            var elementHtml = element.innerHTML;
            console.log(elementHtml);
            $.ajax({
                type: "POST",
                url: "https://192.168.137.234:8080/support",
                contentType: "application/json",
                data: JSON.stringify({
                    markerId: markerId,
                    elementml: elementHtml
                }),
                success: function (data) {
                },
                dataType: "text"
            }).done(function (data) {
                console.log("data" + data);
            });
        }
        function UpdatePic(targetID) {
            console.log("UpdatePic", targetID);
            var strupdate = document.getElementById(targetID).value; 
            targetID = targetID.substring(0, targetID.length - 1);
            console.log(strupdate, targetID);
            var fbtn = "#" + targetID + "A .imgMarker";
            document.querySelector(fbtn).setAttribute('src', strupdate);
            var markerId = targetID + "A";
            var element = document.getElementById(markerId);
            var elementHtml = element.innerHTML;
            console.log(elementHtml);
            $.ajax({
                type: "POST",
                url: "https://192.168.137.234:8080/support",
                contentType: "application/json",
                data: JSON.stringify({
                    markerId: markerId,
                    elementml: elementHtml
                }),
                success: function (data) {
                },
                dataType: "text"
            }).done(function (data) {
                console.log("data" + data);
            });
        }
        
        function UpdateText(targetID) {
            console.log("UpdateText", targetID);
            var strupdate = document.getElementById(targetID).value;
            console.log(strupdate);
            var fbtn = "#" + targetID + "A .aentitiyblock";
            document.querySelector(fbtn).setAttribute('value', strupdate);
            var markerId = targetID + "A";
            var element = document.getElementById(markerId);
            var elementHtml = element.innerHTML;
            console.log(elementHtml);
            $.ajax({
                type: "POST",
                url: "https://192.168.137.234:8080/support",
                contentType: "application/json",
                data: JSON.stringify({
                    markerId: markerId,
                    elementml: elementHtml
                }),
                success: function (data) {
                },
                dataType: "text"
            }).done(function (data) {
                console.log("data" + data);
            });
        }
         
        AFRAME.registerComponent('registerevents', {
            init: function () {
                var marker = this.el;

                // Make the element emit events when found and when lost.
                marker.setAttribute('emitevents', 'true');

                marker.addEventListener('markerFound', function () {
                    var markerId = marker.id;
                    console.log('markerFound', markerId);
                    var fbtn = "#" + markerId + " .aentitiyblock";
                    var targetID = markerId.substring(0, markerId.length - 1);
                    var strupdate = document.getElementById(targetID).value;
                    document.querySelector(fbtn).setAttribute('value', strupdate);
                    var element = document.getElementById(markerId);
                    var elementHtml = element.innerHTML;
                    $.ajax({
                        type: "POST",
                        url: "https://192.168.137.234:8080/support",
                        contentType: "application/json",
                        data: JSON.stringify({
                            markerId: markerId,
                            elementml: elementHtml
                        }),
                        success: function (data) { 
                        },
                        dataType: "text"
                    }).done(function (data) {
                        console.log("data" + data);
                    });
                });

                marker.addEventListener('markerLost', function () {
                    var markerId = marker.id;
                    console.log('markerLost', markerId);
                    console.log("Marker Gone!");
                    // TODO: Add your own code here to react to the marker being lost.
                });
            }
        });
        //var photo = document.getElementById("photo");
        //var markerPlacer = document.querySelector("#markerPlacer");
        //var mixedCanvas = document.getElementById("webcam2d");
        //var context = mixedCanvas.getContext("2d");
        //var img = new Image;
        //img.onload = function () {
        //    screenwidth = img.width;
        //    screenheight = img.height;
        //    context.drawImage(img, 0, 0); // Or at whatever offset you like
        //};
        //function getScreenCapture(senderId, dataType, data, targetId) {
        //    console.log("senderId " + senderId, data);
        //    img.src = data;
        //};
        //NAF.connection.subscribeToDataChannel("sc", getScreenCapture)

        function sendScreen() {
            $.ajax({
                type: "POST",
                url: "https://192.168.137.234:8080/",
                contentType: "application/json",
                data: JSON.stringify({
                    markerId: "sc",
                }),
                success: function (data) {
                    var t = JSON.parse(data);
                    var htmlstr = JSON.parse(t['payload']);
                    document.getElementById("markerPlacer").innerHTML = htmlstr['response'];
                    //img.src = htmlstr['response'];
                },
                dataType: "text"
            }).done(function (data) {
            });
        }
        //  var receiveCmd = setInterval(sendScreen, 200);
        //var btnStop = document.getElementById("myStopInterval");
        //var btnStart = document.getElementById("startInterval");
        //btnStop.onclick = function () {
        //    clearInterval(receiveCmd);
        //    btnStop.style.display = "none";
        //    btnStart.style.display = "block";
        //}
        //btnStart.onclick = function () {
        //    receiveCmd = setInterval(sendScreen, 2000);
        //    btnStart.style.display = "none";
        //    btnStop.style.display = "block";
        //}
        var newTagID = 11;
        var newTagBtn = document.getElementById("newTagBtn");
        const editForm = document.querySelector('#editTextForm');
        newTagBtn.onclick = function () { 
            let strNewTag = "ttext" + newTagID;
            var newTagNum = 3 + newTagID - 10;
            console.log("newtagselect " + newTagNum + ": " + strNewTag);

            var tag_table_element = document.getElementById("tag_table");
            var new_row = tag_table_element.insertRow(-1);

            var new_cell_tag_name = new_row.insertCell(0);
            new_cell_tag_name.innerHTML = '<label for="'+strNewTag+'">Tag '+newTagNum+':</label>';
            
            var new_cell_tag_field = new_row.insertCell(1);
            new_cell_tag_field.innerHTML = '<input type="text" name="'+strNewTag+'" id="'+strNewTag+'" className="updatetextfield" for="'+strNewTag+'"> </input>';

            var newinput = document.getElementById(strNewTag);
            newinput.addEventListener('change', function (e) {
                console.log("newinput.addEventListener", this.id);
                UpdateText(this.id);
            },  false
            ); 

            // editForm.appendChild(newinput);
            var newAlldiv = document.createElement("div");
            var newPdiv = document.createElement("span");
            // newPdiv.className = "clickToshowImg";
            // newPdiv.addEventListener('mouseover', function (e) {
            //     console.log("newPdiv.onmouseover", this.id);
            //     showInput(this);
            // }, false
            // );
            // var newPimg = document.createElement("img");
            // newPimg.src = "img/image_icon.png";
            // var newPinput = document.createElement("input");
            // newPinput.type = "text";
            // newPinput.name = strNewTag+"p";
            // newPinput.id = strNewTag+"p";
            // newPinput.className = "hideInput updatetextfield";
            // newPinput.value ="open.png"
            // newPinput.addEventListener('change', function (e) {
            //     console.log("newPinput.addEventListener", this.id);
            //     UpdatePic(this.id);
            // }, false
            // );
            // newPdiv.appendChild(newPimg);
            // newPdiv.appendChild(newPinput);
            newAlldiv.appendChild(newPdiv);
           

            var newVdiv = document.createElement("span");
            newVdiv.className = "clickToshowImg";
            newVdiv.addEventListener('mouseover', function (e) {
                console.log("newVinput.onmouseover", this.id);
                showInput(this);
            }, false
            );
            // var newVimg = document.createElement("img");
            // newVimg.src = "img/videoicon.png";
            // var newVinput = document.createElement("input");
            // newVinput.type = "text";
            // newVinput.name = strNewTag + "v";
            // newVinput.id = strNewTag + "v";
            // newVinput.className = "hideInput updatetextfield";
            // newVinput.value = "";
            // newVinput.addEventListener('change', function (e) {
            //     console.log("newPinput.addEventListener", this.id);
            //     UpdateVid(this.id);
            // }, false
            // );
            // newVdiv.appendChild(newVimg);
            // newVdiv.appendChild(newVinput);
            // newAlldiv.appendChild(newVdiv);
            editForm.appendChild(newAlldiv);
            var amarkerid = strNewTag + "A";
            $('<a-marker />', {
                id: amarkerid,
                type: "barcode",
                size: "0.06",
                value: newTagID,
                appendTo: $('#markerPlacer')
            });
            document.querySelector('#' + amarkerid).setAttribute('registerevents', '');
            $('<a-entity />', {
                networked: "template:#marker-template",
                appendTo: $('#' + amarkerid)
            });
            newTagID++;
        }
    </script>
</body>
</html>

